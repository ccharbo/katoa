<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="minimal-ui">

    <!-- Safari related -->
    <link rel="apple-touch-icon" href="img/icon64.png"> <!-- specify an icon for the webpage -->
    <link rel="apple-touch-startup-image" href="img/logo.png">
    <!-- specify a launch screen image that is displayed while the web application launches -->
    <meta name="apple-mobile-web-app-title" content="TLMVPSP">
    <!-- specify a web application title for the launch icon -->
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- hiding Safari User Interface Components -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <meta name="viewport"
        content="width = device-width, initial-scale = 1.0, minimum-scale = 1, maximum-scale = 1, user-scalable = no" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <style>
        .progressbar {
            width: 80%;
            margin: 25px auto;
            border: solid 1px #000;
        }

        .progressbar .inner {
            height: 15px;
            animation: progressbar-countdown;
            animation-iteration-count: 1;
            animation-fill-mode: forwards;
            animation-play-state: paused;
            animation-timing-function: linear;
        }

        @keyframes progressbar-countdown {
            0% {
                width: 0%;
                background: #0F0;
            }

            100% {
                width: 100%;
                background: #F00;
            }
        }
    </style>
</head>

<body>

    <audio id="sound-chrono" src="sounds/chrono.mp3"></audio>
    <audio id="sound-chrono-end" src="sounds/chrono-end.mp3"></audio>
    <audio id="sound-good-answer" src="sounds/good-answer.mp3"></audio>
    <audio id="sound-bad-answer" src="sounds/bad-answer.mp3"></audio>

    <div id="main"></div>

    <!-- https://www.w3schools.com/css/css_icons.asp -->

    <button type="button" class="btn btn-outline-primary" onclick="newPlayer();">Joueur</button>
    &nbsp;

    <br>
    <br>

    <div id="progress1"></div>
    <div id="progress2"></div>
    <div id="progress3"></div>

    <!-- <div class="progress">
        <div class="progress-bar" id="progress-bar" style="width: 20%"></div>
    </div> -->

    <br>
    <br>

    <!-- <a href="#myModal" class="btn btn-lg btn-primary" data-toggle="modal"><i class="fa fa-plus-circle"></i> Nouveau
        joueur</a>
    <div id="myModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nouveau joueur</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Nom</label>
                        <input type="text" class="form-control" id="inputName" placeholder="Nom du joueur">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary"
                        onclick="newPlayer(document.getElementById('inputName').value)">Cr√©er
                    </button>
                </div>
            </div>
        </div>
    </div> -->

    <script type="text/javascript">
        function imageFromTexture(src, x, y, width, height, zoom) {
            img = document.createElement("img")
            img.src = src
            img.style.width = `${width}px`
            img.style.height = `${height}px`
            img.style.objectFit = "none"
            img.style.objectPosition = `-${x}px -${y}px`
            if (zoom) img.style.zoom = zoom

            return img
        }

        class Button {
            constructor(parentId, game, src, x, y, width, height, zoom) {
                this.img = imageFromTexture(src, x, y, width, height, zoom)
                this.img.onclick = () => game.click(this);
                document.getElementById(parentId).appendChild(this.img);
            }

            fade() { this.img.style.opacity = 0.2; }
            brighten() { this.img.style.opacity = 1; }
        }

        class Duo extends Button { constructor(parentId, game) { super(parentId, game, "textures/1x/atf-and/howToPlay.png", 855, 0, 150, 150) } }
        class Carre extends Button { constructor(parentId, game) { super(parentId, game, "textures/1x/atf-and/howToPlay.png", 855, 155, 150, 150) } }
        class Cash extends Button { constructor(parentId, game) { super(parentId, game, "textures/1x/atf-and/howToPlay.png", 855, 310, 150, 150) } }
        class Good extends Button { constructor(parentId, game) { super(parentId, game, "textures/1x/atf-and/missiongfx.png", 588, 338, 313, 253, "40%") } }
        class Bad extends Button { constructor(parentId, game) { super(parentId, game, "textures/1x/atf-and/missiongfx.png", 477, 593, 259, 288, "40%") } }

        class Game {
            constructor(parentId) {
                this.duo = new Duo(parentId, this)
                this.carre = new Carre(parentId, this)
                this.cash = new Cash(parentId, this)
                this.good = new Good(parentId, this)
                this.bad = new Bad(parentId, this)

                this.sounds = {
                    chrono: document.getElementById("sound-chrono"),
                    good: document.getElementById("sound-good-answer"),
                    bad: document.getElementById("sound-bad-answer"),
                }
            }

            click(button) {
                [this.duo, this.carre, this.cash].forEach(b => {
                    if (button == b) {
                        b.brighten()

                        if (this.sounds.chrono.paused) {
                            this.sounds.chrono.currentTime = 1.3
                            this.sounds.chrono.play()
                        } else {
                            this.sounds.chrono.pause()
                        }
                    } else {
                        b.fade()
                    }
                })

                if (button == this.good) {
                    this.sounds.chrono.pause()
                    this.sounds.good.currentTime = .5
                    this.sounds.good.play()
                }

                if (button == this.bad) {
                    this.sounds.chrono.pause()
                    this.sounds.bad.currentTime = 0
                    this.sounds.bad.play()
                }
            }
        }

        class Player {
            name;
            constructor(name) { this.name = name }
        }

        var players = [];

        function newPlayer(name) {
            var player = new Player(name);
            players.push(player);
            console.log("players", players);
            update();
        }

        function update() {
            players.forEach(player => {
                console.log("player", player);
            })
        }

        function createProgressbar(id, duration, callback) {
            var progressbar = document.getElementById(id);
            progressbar.className = 'progressbar';

            var progressbarinner = document.createElement('div');
            progressbarinner.className = 'inner';
            progressbarinner.style.animationDuration = duration;

            if (typeof (callback) === 'function') {
                progressbarinner.addEventListener('animationend', callback);
            }

            progressbar.appendChild(progressbarinner);
            progressbarinner.style.animationPlayState = 'running';
        }

        addEventListener("load", () => {
            new Game("main");
        });

    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

</body>

</html>